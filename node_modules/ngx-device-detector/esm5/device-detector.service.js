import * as tslib_1 from "tslib";
/**
 * Created by ahsanayaz on 08/11/2016.
 */
import { PLATFORM_ID, Inject, Injectable } from '@angular/core';
import { isPlatformBrowser } from '@angular/common';
import * as Constants from './device-detector.constants';
import { ReTree } from './retree';
var DeviceDetectorService = /** @class */ (function () {
    function DeviceDetectorService(platformId) {
        this.platformId = platformId;
        this.ua = '';
        this.userAgent = '';
        this.os = '';
        this.browser = '';
        this.device = '';
        this.os_version = '';
        this.browser_version = '';
        if (isPlatformBrowser(this.platformId)) {
            this.ua = window.navigator.userAgent;
        }
        this._setDeviceInfo();
    }
    /**
     * @author Ahsan Ayaz
     * @desc Sets the initial value of the device when the service is initiated.
     * This value is later accessible for usage
     */
    DeviceDetectorService.prototype._setDeviceInfo = function () {
        var _this = this;
        var reTree = new ReTree();
        var ua = this.ua;
        this.userAgent = ua;
        var mappings = [
            { const: 'OS', prop: 'os' },
            { const: 'BROWSERS', prop: 'browser' },
            { const: 'DEVICES', prop: 'device' },
            { const: 'OS_VERSIONS', prop: 'os_version' },
        ];
        mappings.forEach(function (mapping) {
            _this[mapping.prop] = Object.keys(Constants[mapping.const]).reduce(function (obj, item) {
                obj[Constants[mapping.const][item]] = reTree.test(ua, Constants[mapping.const + "_RE"][item]);
                return obj;
            }, {});
        });
        mappings.forEach(function (mapping) {
            _this[mapping.prop] = Object.keys(Constants[mapping.const])
                .map(function (key) {
                return Constants[mapping.const][key];
            }).reduce(function (previousValue, currentValue) {
                return (previousValue === Constants[mapping.const].UNKNOWN && _this[mapping.prop][currentValue])
                    ? currentValue : previousValue;
            }, Constants[mapping.const].UNKNOWN);
        });
        this.browser_version = '0';
        if (this.browser !== Constants.BROWSERS.UNKNOWN) {
            var re = Constants.BROWSER_VERSIONS_RE[this.browser];
            var res = reTree.exec(ua, re);
            if (!!res) {
                this.browser_version = res[1];
            }
        }
    };
    /**
     * @author Ahsan Ayaz
     * @desc Returns the device information
     * @returns the device information object.
     */
    DeviceDetectorService.prototype.getDeviceInfo = function () {
        var deviceInfo = {
            userAgent: this.userAgent,
            os: this.os,
            browser: this.browser,
            device: this.device,
            os_version: this.os_version,
            browser_version: this.browser_version
        };
        return deviceInfo;
    };
    /**
     * @author Ahsan Ayaz
     * @desc Compares the current device info with the mobile devices to check
     * if the current device is a mobile.
     * @returns whether the current device is a mobile
     */
    DeviceDetectorService.prototype.isMobile = function () {
        var _this = this;
        return [
            Constants.DEVICES.ANDROID,
            Constants.DEVICES.IPHONE,
            Constants.DEVICES.I_POD,
            Constants.DEVICES.BLACKBERRY,
            Constants.DEVICES.FIREFOX_OS,
            Constants.DEVICES.WINDOWS_PHONE,
            Constants.DEVICES.VITA
        ].some(function (item) {
            return _this.device === item;
        });
    };
    ;
    /**
     * @author Ahsan Ayaz
     * @desc Compares the current device info with the tablet devices to check
     * if the current device is a tablet.
     * @returns whether the current device is a tablet
     */
    DeviceDetectorService.prototype.isTablet = function () {
        var _this = this;
        return [
            Constants.DEVICES.I_PAD,
            Constants.DEVICES.FIREFOX_OS
        ].some(function (item) {
            return _this.device === item;
        });
    };
    ;
    /**
     * @author Ahsan Ayaz
     * @desc Compares the current device info with the desktop devices to check
     * if the current device is a desktop device.
     * @returns whether the current device is a desktop device
     */
    DeviceDetectorService.prototype.isDesktop = function () {
        var _this = this;
        return [
            Constants.DEVICES.PS4,
            Constants.DEVICES.CHROME_BOOK,
            Constants.DEVICES.UNKNOWN
        ].some(function (item) {
            return _this.device === item;
        });
    };
    ;
    DeviceDetectorService = tslib_1.__decorate([
        Injectable(),
        tslib_1.__param(0, Inject(PLATFORM_ID)),
        tslib_1.__metadata("design:paramtypes", [Object])
    ], DeviceDetectorService);
    return DeviceDetectorService;
}());
export { DeviceDetectorService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGV2aWNlLWRldGVjdG9yLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtZGV2aWNlLWRldGVjdG9yLyIsInNvdXJjZXMiOlsiZGV2aWNlLWRldGVjdG9yLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHO0FBQ0gsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2hFLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3BELE9BQU8sS0FBSyxTQUFTLE1BQU0sNkJBQTZCLENBQUM7QUFDekQsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFVBQVUsQ0FBQztBQVlsQztJQVNJLCtCQUF5QyxVQUFVO1FBQVYsZUFBVSxHQUFWLFVBQVUsQ0FBQTtRQVJuRCxPQUFFLEdBQUcsRUFBRSxDQUFDO1FBQ1IsY0FBUyxHQUFHLEVBQUUsQ0FBQztRQUNmLE9BQUUsR0FBRyxFQUFFLENBQUM7UUFDUixZQUFPLEdBQUcsRUFBRSxDQUFDO1FBQ2IsV0FBTSxHQUFHLEVBQUUsQ0FBQztRQUNaLGVBQVUsR0FBRyxFQUFFLENBQUM7UUFDaEIsb0JBQWUsR0FBRyxFQUFFLENBQUM7UUFHakIsSUFBSSxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUU7WUFDcEMsSUFBSSxDQUFDLEVBQUUsR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQztTQUN4QztRQUNELElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztJQUMxQixDQUFDO0lBRUQ7Ozs7T0FJRztJQUNLLDhDQUFjLEdBQXRCO1FBQUEsaUJBb0NDO1FBbkNHLElBQUksTUFBTSxHQUFHLElBQUksTUFBTSxFQUFFLENBQUM7UUFDMUIsSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUNqQixJQUFJLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQztRQUNwQixJQUFJLFFBQVEsR0FBRztZQUNYLEVBQUUsS0FBSyxFQUFHLElBQUksRUFBRyxJQUFJLEVBQUUsSUFBSSxFQUFDO1lBQzVCLEVBQUUsS0FBSyxFQUFHLFVBQVUsRUFBRyxJQUFJLEVBQUUsU0FBUyxFQUFDO1lBQ3ZDLEVBQUUsS0FBSyxFQUFHLFNBQVMsRUFBRyxJQUFJLEVBQUUsUUFBUSxFQUFDO1lBQ3JDLEVBQUUsS0FBSyxFQUFHLGFBQWEsRUFBRyxJQUFJLEVBQUUsWUFBWSxFQUFDO1NBQ2hELENBQUM7UUFFRixRQUFRLENBQUMsT0FBTyxDQUFDLFVBQUMsT0FBTztZQUNyQixLQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFDLEdBQVEsRUFBRSxJQUFTO2dCQUNsRixHQUFHLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLFNBQVMsQ0FBSSxPQUFPLENBQUMsS0FBSyxRQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO2dCQUM5RixPQUFPLEdBQUcsQ0FBQztZQUNmLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUNYLENBQUMsQ0FBQyxDQUFDO1FBRUgsUUFBUSxDQUFDLE9BQU8sQ0FBQyxVQUFDLE9BQU87WUFDckIsS0FBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7aUJBQ3pELEdBQUcsQ0FBQyxVQUFDLEdBQUc7Z0JBQ0wsT0FBTyxTQUFTLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3pDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFDLGFBQWEsRUFBRSxZQUFZO2dCQUNsQyxPQUFPLENBQUMsYUFBYSxLQUFLLFNBQVMsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsT0FBTyxJQUFJLEtBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUM7b0JBQ3ZGLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQztZQUMzQyxDQUFDLEVBQUUsU0FBUyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUN6QyxDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxlQUFlLEdBQUcsR0FBRyxDQUFDO1FBQzNCLElBQUksSUFBSSxDQUFDLE9BQU8sS0FBSyxTQUFTLENBQUMsUUFBUSxDQUFDLE9BQU8sRUFBRTtZQUM3QyxJQUFJLEVBQUUsR0FBRyxTQUFTLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3JELElBQUksR0FBRyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQzlCLElBQUksQ0FBQyxDQUFDLEdBQUcsRUFBRTtnQkFDUCxJQUFJLENBQUMsZUFBZSxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUNqQztTQUNKO0lBQ0wsQ0FBQztJQUVEOzs7O09BSUc7SUFDSSw2Q0FBYSxHQUFwQjtRQUNJLElBQU0sVUFBVSxHQUFlO1lBQzNCLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUztZQUN6QixFQUFFLEVBQUcsSUFBSSxDQUFDLEVBQUU7WUFDWixPQUFPLEVBQUUsSUFBSSxDQUFDLE9BQU87WUFDckIsTUFBTSxFQUFHLElBQUksQ0FBQyxNQUFNO1lBQ3BCLFVBQVUsRUFBRSxJQUFJLENBQUMsVUFBVTtZQUMzQixlQUFlLEVBQUUsSUFBSSxDQUFDLGVBQWU7U0FDeEMsQ0FBQztRQUNGLE9BQU8sVUFBVSxDQUFDO0lBQ3RCLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNJLHdDQUFRLEdBQWY7UUFBQSxpQkFZQztRQVhHLE9BQU87WUFDSCxTQUFTLENBQUMsT0FBTyxDQUFDLE9BQU87WUFDekIsU0FBUyxDQUFDLE9BQU8sQ0FBQyxNQUFNO1lBQ3hCLFNBQVMsQ0FBQyxPQUFPLENBQUMsS0FBSztZQUN2QixTQUFTLENBQUMsT0FBTyxDQUFDLFVBQVU7WUFDNUIsU0FBUyxDQUFDLE9BQU8sQ0FBQyxVQUFVO1lBQzVCLFNBQVMsQ0FBQyxPQUFPLENBQUMsYUFBYTtZQUMvQixTQUFTLENBQUMsT0FBTyxDQUFDLElBQUk7U0FDekIsQ0FBQyxJQUFJLENBQUMsVUFBQyxJQUFJO1lBQ1IsT0FBTyxLQUFJLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQztRQUNoQyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFBQSxDQUFDO0lBRUY7Ozs7O09BS0c7SUFDSSx3Q0FBUSxHQUFmO1FBQUEsaUJBT0M7UUFORyxPQUFPO1lBQ0gsU0FBUyxDQUFDLE9BQU8sQ0FBQyxLQUFLO1lBQ3ZCLFNBQVMsQ0FBQyxPQUFPLENBQUMsVUFBVTtTQUMvQixDQUFDLElBQUksQ0FBQyxVQUFDLElBQUk7WUFDUixPQUFPLEtBQUksQ0FBQyxNQUFNLEtBQUssSUFBSSxDQUFDO1FBQ2hDLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUFBLENBQUM7SUFFRjs7Ozs7T0FLRztJQUNJLHlDQUFTLEdBQWhCO1FBQUEsaUJBUUM7UUFQRyxPQUFPO1lBQ0gsU0FBUyxDQUFDLE9BQU8sQ0FBQyxHQUFHO1lBQ3JCLFNBQVMsQ0FBQyxPQUFPLENBQUMsV0FBVztZQUM3QixTQUFTLENBQUMsT0FBTyxDQUFDLE9BQU87U0FDNUIsQ0FBQyxJQUFJLENBQUMsVUFBQyxJQUFJO1lBQ1IsT0FBTyxLQUFJLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQztRQUNoQyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFBQSxDQUFDO0lBN0hPLHFCQUFxQjtRQURqQyxVQUFVLEVBQUU7UUFVSSxtQkFBQSxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUE7O09BVHZCLHFCQUFxQixDQThIakM7SUFBRCw0QkFBQztDQUFBLEFBOUhELElBOEhDO1NBOUhZLHFCQUFxQiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ3JlYXRlZCBieSBhaHNhbmF5YXogb24gMDgvMTEvMjAxNi5cbiAqL1xuaW1wb3J0IHsgUExBVEZPUk1fSUQsIEluamVjdCwgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgaXNQbGF0Zm9ybUJyb3dzZXIgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0ICogYXMgQ29uc3RhbnRzIGZyb20gJy4vZGV2aWNlLWRldGVjdG9yLmNvbnN0YW50cyc7XG5pbXBvcnQgeyBSZVRyZWUgfSBmcm9tICcuL3JldHJlZSc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRGV2aWNlSW5mbyB7XG4gICAgdXNlckFnZW50OiBzdHJpbmc7XG4gICAgb3M6IHN0cmluZztcbiAgICBicm93c2VyOiBzdHJpbmc7XG4gICAgZGV2aWNlOiBzdHJpbmc7XG4gICAgb3NfdmVyc2lvbjogc3RyaW5nO1xuICAgIGJyb3dzZXJfdmVyc2lvbjogc3RyaW5nO1xufVxuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgRGV2aWNlRGV0ZWN0b3JTZXJ2aWNlIHtcbiAgICB1YSA9ICcnO1xuICAgIHVzZXJBZ2VudCA9ICcnO1xuICAgIG9zID0gJyc7XG4gICAgYnJvd3NlciA9ICcnO1xuICAgIGRldmljZSA9ICcnO1xuICAgIG9zX3ZlcnNpb24gPSAnJztcbiAgICBicm93c2VyX3ZlcnNpb24gPSAnJztcblxuICAgIGNvbnN0cnVjdG9yKEBJbmplY3QoUExBVEZPUk1fSUQpIHByaXZhdGUgcGxhdGZvcm1JZCkge1xuICAgICAgICBpZiAoaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybUlkKSkge1xuICAgICAgICAgICAgdGhpcy51YSA9IHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3NldERldmljZUluZm8oKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAYXV0aG9yIEFoc2FuIEF5YXpcbiAgICAgKiBAZGVzYyBTZXRzIHRoZSBpbml0aWFsIHZhbHVlIG9mIHRoZSBkZXZpY2Ugd2hlbiB0aGUgc2VydmljZSBpcyBpbml0aWF0ZWQuXG4gICAgICogVGhpcyB2YWx1ZSBpcyBsYXRlciBhY2Nlc3NpYmxlIGZvciB1c2FnZVxuICAgICAqL1xuICAgIHByaXZhdGUgX3NldERldmljZUluZm8oKSB7XG4gICAgICAgIGxldCByZVRyZWUgPSBuZXcgUmVUcmVlKCk7XG4gICAgICAgIGxldCB1YSA9IHRoaXMudWE7XG4gICAgICAgIHRoaXMudXNlckFnZW50ID0gdWE7XG4gICAgICAgIGxldCBtYXBwaW5ncyA9IFtcbiAgICAgICAgICAgIHsgY29uc3QgOiAnT1MnICwgcHJvcDogJ29zJ30sXG4gICAgICAgICAgICB7IGNvbnN0IDogJ0JST1dTRVJTJyAsIHByb3A6ICdicm93c2VyJ30sXG4gICAgICAgICAgICB7IGNvbnN0IDogJ0RFVklDRVMnICwgcHJvcDogJ2RldmljZSd9LFxuICAgICAgICAgICAgeyBjb25zdCA6ICdPU19WRVJTSU9OUycgLCBwcm9wOiAnb3NfdmVyc2lvbid9LFxuICAgICAgICBdO1xuXG4gICAgICAgIG1hcHBpbmdzLmZvckVhY2goKG1hcHBpbmcpID0+IHtcbiAgICAgICAgICAgIHRoaXNbbWFwcGluZy5wcm9wXSA9IE9iamVjdC5rZXlzKENvbnN0YW50c1ttYXBwaW5nLmNvbnN0XSkucmVkdWNlKChvYmo6IGFueSwgaXRlbTogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgb2JqW0NvbnN0YW50c1ttYXBwaW5nLmNvbnN0XVtpdGVtXV0gPSByZVRyZWUudGVzdCh1YSwgQ29uc3RhbnRzW2Ake21hcHBpbmcuY29uc3R9X1JFYF1baXRlbV0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgICAgICB9LCB7fSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIG1hcHBpbmdzLmZvckVhY2goKG1hcHBpbmcpID0+IHtcbiAgICAgICAgICAgIHRoaXNbbWFwcGluZy5wcm9wXSA9IE9iamVjdC5rZXlzKENvbnN0YW50c1ttYXBwaW5nLmNvbnN0XSlcbiAgICAgICAgICAgIC5tYXAoKGtleSkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBDb25zdGFudHNbbWFwcGluZy5jb25zdF1ba2V5XTtcbiAgICAgICAgICAgIH0pLnJlZHVjZSgocHJldmlvdXNWYWx1ZSwgY3VycmVudFZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChwcmV2aW91c1ZhbHVlID09PSBDb25zdGFudHNbbWFwcGluZy5jb25zdF0uVU5LTk9XTiAmJiB0aGlzW21hcHBpbmcucHJvcF1bY3VycmVudFZhbHVlXSlcbiAgICAgICAgICAgICAgICAgICAgICAgID8gY3VycmVudFZhbHVlIDogcHJldmlvdXNWYWx1ZTtcbiAgICAgICAgICAgIH0sIENvbnN0YW50c1ttYXBwaW5nLmNvbnN0XS5VTktOT1dOKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5icm93c2VyX3ZlcnNpb24gPSAnMCc7XG4gICAgICAgIGlmICh0aGlzLmJyb3dzZXIgIT09IENvbnN0YW50cy5CUk9XU0VSUy5VTktOT1dOKSB7XG4gICAgICAgICAgICBsZXQgcmUgPSBDb25zdGFudHMuQlJPV1NFUl9WRVJTSU9OU19SRVt0aGlzLmJyb3dzZXJdO1xuICAgICAgICAgICAgbGV0IHJlcyA9IHJlVHJlZS5leGVjKHVhLCByZSk7XG4gICAgICAgICAgICBpZiAoISFyZXMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmJyb3dzZXJfdmVyc2lvbiA9IHJlc1sxXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBhdXRob3IgQWhzYW4gQXlhelxuICAgICAqIEBkZXNjIFJldHVybnMgdGhlIGRldmljZSBpbmZvcm1hdGlvblxuICAgICAqIEByZXR1cm5zIHRoZSBkZXZpY2UgaW5mb3JtYXRpb24gb2JqZWN0LlxuICAgICAqL1xuICAgIHB1YmxpYyBnZXREZXZpY2VJbmZvKCk6IERldmljZUluZm8ge1xuICAgICAgICBjb25zdCBkZXZpY2VJbmZvOiBEZXZpY2VJbmZvID0ge1xuICAgICAgICAgICAgdXNlckFnZW50OiB0aGlzLnVzZXJBZ2VudCxcbiAgICAgICAgICAgIG9zIDogdGhpcy5vcyxcbiAgICAgICAgICAgIGJyb3dzZXI6IHRoaXMuYnJvd3NlcixcbiAgICAgICAgICAgIGRldmljZSA6IHRoaXMuZGV2aWNlLFxuICAgICAgICAgICAgb3NfdmVyc2lvbjogdGhpcy5vc192ZXJzaW9uLFxuICAgICAgICAgICAgYnJvd3Nlcl92ZXJzaW9uOiB0aGlzLmJyb3dzZXJfdmVyc2lvblxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZGV2aWNlSW5mbztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAYXV0aG9yIEFoc2FuIEF5YXpcbiAgICAgKiBAZGVzYyBDb21wYXJlcyB0aGUgY3VycmVudCBkZXZpY2UgaW5mbyB3aXRoIHRoZSBtb2JpbGUgZGV2aWNlcyB0byBjaGVja1xuICAgICAqIGlmIHRoZSBjdXJyZW50IGRldmljZSBpcyBhIG1vYmlsZS5cbiAgICAgKiBAcmV0dXJucyB3aGV0aGVyIHRoZSBjdXJyZW50IGRldmljZSBpcyBhIG1vYmlsZVxuICAgICAqL1xuICAgIHB1YmxpYyBpc01vYmlsZSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIENvbnN0YW50cy5ERVZJQ0VTLkFORFJPSUQsXG4gICAgICAgICAgICBDb25zdGFudHMuREVWSUNFUy5JUEhPTkUsXG4gICAgICAgICAgICBDb25zdGFudHMuREVWSUNFUy5JX1BPRCxcbiAgICAgICAgICAgIENvbnN0YW50cy5ERVZJQ0VTLkJMQUNLQkVSUlksXG4gICAgICAgICAgICBDb25zdGFudHMuREVWSUNFUy5GSVJFRk9YX09TLFxuICAgICAgICAgICAgQ29uc3RhbnRzLkRFVklDRVMuV0lORE9XU19QSE9ORSxcbiAgICAgICAgICAgIENvbnN0YW50cy5ERVZJQ0VTLlZJVEFcbiAgICAgICAgXS5zb21lKChpdGVtKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kZXZpY2UgPT09IGl0ZW07XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAYXV0aG9yIEFoc2FuIEF5YXpcbiAgICAgKiBAZGVzYyBDb21wYXJlcyB0aGUgY3VycmVudCBkZXZpY2UgaW5mbyB3aXRoIHRoZSB0YWJsZXQgZGV2aWNlcyB0byBjaGVja1xuICAgICAqIGlmIHRoZSBjdXJyZW50IGRldmljZSBpcyBhIHRhYmxldC5cbiAgICAgKiBAcmV0dXJucyB3aGV0aGVyIHRoZSBjdXJyZW50IGRldmljZSBpcyBhIHRhYmxldFxuICAgICAqL1xuICAgIHB1YmxpYyBpc1RhYmxldCgpIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIENvbnN0YW50cy5ERVZJQ0VTLklfUEFELFxuICAgICAgICAgICAgQ29uc3RhbnRzLkRFVklDRVMuRklSRUZPWF9PU1xuICAgICAgICBdLnNvbWUoKGl0ZW0pID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRldmljZSA9PT0gaXRlbTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBhdXRob3IgQWhzYW4gQXlhelxuICAgICAqIEBkZXNjIENvbXBhcmVzIHRoZSBjdXJyZW50IGRldmljZSBpbmZvIHdpdGggdGhlIGRlc2t0b3AgZGV2aWNlcyB0byBjaGVja1xuICAgICAqIGlmIHRoZSBjdXJyZW50IGRldmljZSBpcyBhIGRlc2t0b3AgZGV2aWNlLlxuICAgICAqIEByZXR1cm5zIHdoZXRoZXIgdGhlIGN1cnJlbnQgZGV2aWNlIGlzIGEgZGVza3RvcCBkZXZpY2VcbiAgICAgKi9cbiAgICBwdWJsaWMgaXNEZXNrdG9wKCkge1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgQ29uc3RhbnRzLkRFVklDRVMuUFM0LFxuICAgICAgICAgICAgQ29uc3RhbnRzLkRFVklDRVMuQ0hST01FX0JPT0ssXG4gICAgICAgICAgICBDb25zdGFudHMuREVWSUNFUy5VTktOT1dOXG4gICAgICAgIF0uc29tZSgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGV2aWNlID09PSBpdGVtO1xuICAgICAgICB9KTtcbiAgICB9O1xufVxuIl19